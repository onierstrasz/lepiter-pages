---Title: Porting the PP1 YAML parser---#Porting the PP1 YAML parser- #TL;DR    - We need a YAML parser for the Workflow Evolution project. (See [EGAD](https://github.com/pavt/egad).)    - There was a YAML parser in the [](https://github.com/moosetechnology/PetitParser) repo. See the [PetitYAML](https://github.com/moosetechnology/PetitParser/tree/development/src/PetitYAML) package. It manages indentation by storing the necessary information in the `PPContext`. See {{gtClass:name=PP2Context}}. TG tried to port the package and the missing PP1 classes to PP2, but it's not working yet.- Basically I gave up on this and started working on a new implementation.- See [[YAML Parser project #3046]].- #Todo    - {{gtTodo:label=Port the PPYAMLGrammar to PP2 with all its dependencies|completed=2023-02-08}}    - {{gtTodo:label=Debug the ported PP2YAMLGrammar class}}    - {{gtTodo:label=Start implementing the missing parts (separators, folding ....}}- #The old parser    - Load it as follows (NB: just proceed if there is an error).    - Metacello new
   baseline: 'PetitParser';
   repository: 'github://moosetechnology/PetitParser/src';
   load.    - Here's a sample usage:    - PPYAMLGrammar	parse: ('gtoolkit.yaml' asFileReference contents removePrefix: '---').    - Note that the grammar is not complete. In particular the document separators are not supported.- #The ported parser    - See {{gtClass:name=PP2YAMLGrammar}}.    - PP2YAMLGrammar parse: 'foo'.- #Debugging    - ##Reset strategy        - {{gtTodo:label=Implement resetStrategy in PP2CompareNode}}        - Need to implement `PP2CompareNode(PP2Node)>>resetStrategy`.        - #resetStrategy gtImplementors        - It looks like it should be implemented as follows:        - ```language=text
resetStrategy	strategy := PP2Compare on: self
```        - But there is no `PP2Compare` class.        - The {{gtClass:name=PP2CompareNode}} class was simply ported from {{gtClass:name=PPCompareParser}}, but not this should be split into two classes, and the `parseOn:` method should be implemented by the delegate class specified in the resetStrategy method.        - It seems there are multiple classes that need to be adapted.        - PP2CompareNode package classes	select: [ :each | 		(each inheritsFrom: PP2Node)			and: [ [ each new resetStrategy.				false ] on: SubclassResponsibility do: [ true ] ] ]        - The problem is that the PP2Node hierarchy is different from the PP1 Parser hierarchy as it is split into nodes and strategies. The nodes have to implement visitors as well as `firstCharSet` method.        - As a first attempt, I define {{gtMethod:name=PP2CompareNode>>resetStrategy}} to return `self`.        - Now I am stuck in {{gtMethod:name=PP2InMemoryContext>>column}}.  The issue is that {{gtClass:name=PP2InMemoryContext}} is a subclass of {{gtClass:name=ReadStream}}, so the “stream” is `self`. However the `column` method comes from {{gtClass:name=PPStream}}, so there is more stuff that would need to be ported ...