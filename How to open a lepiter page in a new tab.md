---Title: How to open a lepiter page in a new tab---#How to open a lepiter page in a new tab- [[howto]] [[lepiter]] [[exercise]]- See also [[Where are buttons implemented?]]- #Task:    - We would like to add a button that opens a lepiter page in a new tab or a new window, much like the inspect object in new window button.- #Opening a page in a new window    - By inspecting the view code of an "Inspect Object in a New Window" button we find {{gtMethod:name=ProtoObject>>#gtActionInspectInWindowFor:|expanded}}    - We try out this code:    - (GtPager	openWrappedOn: (GtInspectorTool forObject: thisSnippet page)	title: (thisSnippet page title format: {self})) maximized    - But this is an inspector, not the actual page.    - We browse the hierarchy of {{gtClass:name=GtInspectorTool}} and find {{gtClass:name=LePagePhlowTool}}.    - (GtPager	openWrappedOn: (LePagePhlowTool page: thisSnippet page)	title: (thisSnippet page title format: {self})) maximized- #Opening a specific page    - We can open a specific page like this:    - databaseName := thisSnippet page database databaseName.pageTitle := thisSnippet page title.database := LeDatabasesRegistry default currentLoadedDefaultLogicalDatabase		databaseNamed: databaseName.page := database pageNamed: pageTitle.(GtPager	openWrappedOn: (LePagePhlowTool page: page)	title: (page title format: {self})) maximized- #Opening a page in a new tab    - If we inspect the view code of the "Browse class" button, we find {{gtMethod:name=ProtoObject>>#gtActionBrowseFor:|expanded}}    - We check out  {{gtMethod:name=ProtoObject>>#gtBrowseFrom:|expanded}}    - So the button (anElement) needs to provide the context for the pager.    - We also want a Lepiter Page, not a coder. It's not clear that we can use this to open a page.    - We need to follow the breadcrumbs before we find the code we eventually get below.    - We'll need a button before we can experiment further.- #Adding the Open in New Window button    - Now, how to add the button to each lepiter page? Where are the buttons implemented?    - See [[Where are buttons implemented?]]    - If we try to inspect the "Copy as Remote Reference" button view code, nothing happens. Where is the button added?    - Let's try to add the button to open the page in a new window.    - LePageHeaderBuilder	compile: 'addOpenInNewWindowButton	"Add a button to open this page in a new window."	| newButton |	newButton := BrButton new			aptitude: BrGlamorousButtonWithIconAptitude;			label: ''Open page in new window'';			icon: BrGlamorousIcons maximize;			action: [ :aButton | 				(GtPager					openWrappedOn: (LePagePhlowTool page: self page)					title: (self page title format: {self})) maximized ].	self toolbarElement addItem: newButton'    - We add this method to the build script.    - LePageHeaderWithTitleAndRemoveActionBuilder compile: 'build	self removeAllItems.	self addTitle.	self addRemoteLinkToClipboardButton.	self addRemovePageButton.	self addOpenInNewWindowButton.	self addTableOfContentsToggle.	self addExtensionButtons.'    - Let's inspect [[How to open a lepiter page in a new tab]]    - It works!- #Adding the Open in New Tab button    - We add the new button.    - LePageHeaderBuilder	compile: 'addOpenInNewTabButton	"Add a button to open this page in a new world tab."	| newButton |	newButton := BrButton new			aptitude: BrGlamorousButtonWithIconAptitude;			label: ''Open page in a new world tab'';			icon: BrGlamorousIcons spawn;			action: [ :aButton | 				GtPager					openOn: (GtPagerWrapperElement new tool: (LePagePhlowTool page: self page))					title: ''aTitle''					from: aButton ].	self toolbarElement addItem: newButton'    - We add it to the build script.    - LePageHeaderWithTitleAndRemoveActionBuilder compile: 'build	self removeAllItems.	self addTitle.	self addRemoteLinkToClipboardButton.	self addRemovePageButton.	self addOpenInNewTabButton.	self addTableOfContentsToggle.	self addExtensionButtons.'    - But what is the code we need for the button?- #Refactoring for the open in new tab button    - The code to open a new tab is simpler in the "browse in new tab" button: {{gtMethod:name=ProtoObject>>#gtActionBrowseFor:|expanded}}    - We should add the {{gtClass:name=TGtPagerPageInstantiator}} trait to {{gtClass:name=LePageToolElement}}.    - Now we can rewrite  {{gtMethod:name=LePageHeaderBuilder>>#addOpenInNewTabButton}}  as follows:    - LePageHeaderBuilder	compile: 'addOpenInNewTabButton	"Add a button to open this page in a new world tab."	| newButton |	newButton := BrButton new			aptitude: BrGlamorousButtonWithIconAptitude;			label: ''Open page in a new world tab'';			icon: BrGlamorousIcons spawn;			action: [ :aButton | ((LePagePhlowTool page: self page) asElement openInPagerFrom: aButton) maximized ].	self toolbarElement addItem: newButton'- #Changed methods, packages and repos    - {{gtClass:name=LePageToolElement}},  {{gtMethod:name=LePageHeaderBuilder>>#addOpenInNewTabButton}} and {{gtMethod:name=LePageHeaderWithTitleAndRemoveActionBuilder>>#build}}  all in the `lepiter` repo.- #Bug â€” missing inspect button    - This works, but the spawned page is missing the round (i) inspect button.    - [[AC]] says to use `asLepiterPagePhlowTool` to create a tool for a page.    - thisSnippet page asLepiterPagePhlowTool    - He also points out that the code to open start page is in {{gtMethod:name=GtHomeGetStartedSection>>create}}    - Let's try that:    - LePageHeaderBuilder	compile: 'addOpenInNewTabButton	"Add a button to open this page in a new world tab."	| newButton |	newButton := BrButton new			aptitude: BrGlamorousButtonWithIconAptitude;			label: ''Open page in a new world tab'';			icon: BrGlamorousIcons spawn;			action: [ :aButton | 				GtWorldUtility					showSpaceWithTitle: self page title					inPagerWith: [ self page asLepiterPagePhlowTool asElementDo: [ :e | e ] ]							asStencil					from: aButton ].	self toolbarElement addItem: newButton'    - Finally this seems to work!- #Adding the button to the Inspector page    - When we are inspecting a page, we would also like to open that page in a new tab (i.e., *not* another inspector view).    - The buttons are all implemented in the {{gtClass:name=LePage}} class or in {{gtClass:name=ProtoObject}}.    - We want to add {{gtMethod:name=LePage>>gtOpenInNewTabActionFor:|expanded}}.